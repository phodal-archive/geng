/*! geng 29-06-2015 */
!function(a,b){"use strict";function c(){this.childs={},this._isWord=!1,this._count=0}function d(){this.root=new c}function e(a){function b(){for(var a=[],b=0,c=this.state,e=this.index,f=this.input,g=0,h=d.length;h>g;g++){var i=d[g],j=i.start,k=j.length;if(!k||j.indexOf(c)>=0||c%2&&1===k&&!j[0]){var l=i.pattern;l.lastIndex=e;var m=l.exec(f);if(m&&m.index===e){var n=a.push({result:m,action:i.action,length:m[0].length});for(i.global&&(b=n);--n>b;){var o=n-1;if(a[n].length>a[o].length){var p=a[n];a[n]=a[o],a[o]=p}}}}}return a}"function"!=typeof a&&(a=this.defunct);var c=[],d=[],e=0;this.state=0,this.index=0,this.input="",this.defunct=function(a){throw new Error("Unexpected character at index "+(this.index-1)+": "+a)},this.addRule=function(a,b,c){var e=a.global;if(!e){var f="g";a.multiline&&(f+="m"),a.ignoreCase&&(f+="i"),a=new RegExp(a.source,f)}return"[object Array]"!==Object.prototype.toString.call(c)&&(c=[0]),d.push({pattern:a,global:e,action:b,start:c}),this},this.setInput=function(a){return e=0,this.state=0,this.index=0,c.length=0,this.input=a,this},this.lex=function(){if(c.length)return c.shift();for(this.reject=!0;this.index<=this.input.length;){for(var d=b.call(this).splice(e),f=this.index;d.length&&this.reject;){var g=d.shift(),h=g.result,i=g.length;this.index+=i,this.reject=!1,e++;var j=g.action.apply(this,h);if(this.reject)this.index=h.index;else if("undefined"!=typeof j)switch(Object.prototype.toString.call(j)){case"[object Array]":c=j.slice(1),j=j[0];break;default:return i&&(e=0),j}}var k=this.input;if(f<k.length)if(this.reject){e=0;var l=a.call(this,k.charAt(this.index++));if("undefined"!=typeof l)return"[object Array]"===Object.prototype.toString.call(l)?(c=l.slice(1),l[0]):l}else this.index!==f&&(e=0),this.reject=!0;else{if(!d.length)break;this.reject=!0}}}}var f={"çš„":1};c.prototype={isWord:function(){return this._isWord&&0===this._count},asWord:function(){this._isWord=!0},addCount:function(){this._count++}},d.prototype={toBytes:function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b.push(d):b=b.concat(this.toUTF8(d))}return b},toUTF8:function(a){var b,c,d;return b=224|a>>12&15,c=128|a>>6&63,d=128|63&a,[b,c,d]},toUTF16:function(a,b,c){var d,e,f;return d=a<<4|b>>2&15,e=(3&b)<<6|63&c,f=(255&d)<<8|e},add:function(a){for(var b=this.root,d=this.toBytes(a),e=d.length,f=0;e>f;f++){var g=d[f];g in b.childs||(b.childs[g]=new c(g)),b=b.childs[g]}b.asWord()},search:function(a){for(var b=this.root,c=a.length,d=[],e=[],g=0,h=0;c>h;h++){var i=a[h],j=b.childs;if(!(i in j))return d;if(128>i)e.push(String.fromCharCode(i));else if(g++,g%3===0){var k=a[h-2],l=a[h-1],m=i;e.push(String.fromCharCode(this.toUTF16(k,l,m)))}if(e.join("")in f)return d;var n=j[i];n.isWord()&&(n.addCount(),d.push(e.join(""))),b=n}return d},splitWords:function(a){for(var b=this.toBytes(a),c=0,d=b.length-1,e=[];c!=d;){for(var f=[],g=c;d>=g;g++){var h=b[g];f.push(h);var i=this.search(f);i!==!1&&i.length>0&&(e=e.concat(i))}c++}return e},init:function(a){for(var b=0;b<a.length;b++)this.add(a[b])}};var g=function(){this.rule=[],this.error=[]};g.learn=function(a){a.constructor===RegExp?this.rule.append(a):this.error.append("not a regex")},g.parser=function(a){return this.time=a,this},g.to=function(a){return this.type=a,this},g.convert=function(){return this.time+this.type},g.version=g.VERSION="0.0.0",g.trie=d,g.lexer=e,a.Geng=g}(this);