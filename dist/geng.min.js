/*! geng 10-07-2015 */
!function(a,b){"use strict";function c(a){if(this.options={},"undefined"!=typeof a){if(!a||"object"!=typeof a||Array.isArray(a))throw new TypeError("Bayes got invalid `options`: `"+a+"`. Pass in an object.");this.options=a}this.tokenizer=this.options.tokenizer||g,"Chinese"===this.options.tokenizer&&(this.tokenizer=h),this.vocabulary={},this.vocabularySize=0,this.totalDocuments=0,this.docCount={},this.wordCount={},this.wordFrequencyCount={},this.categories={}}function d(){this.childs={},this._isWord=!1,this._count=0}function e(){this.root=new d}function f(a){function b(){for(var a=this,b=[],c=0,e=0,f=d.length;f>e;e++){var g=d[e],h=g.start,i=h.length;if(!i||h.indexOf(a.state)>=0||a.state%2&&1===i&&!h[0]){var j=g.pattern;j.lastIndex=a.index;var k=j.exec(a.input);if(k&&k.index===a.index){var l=b.push({result:k,action:g.action,length:k[0].length});for(g.global&&(c=l);--l>c;){var m=l-1;if(b[l].length>b[m].length){var n=b[l];b[l]=b[m],b[m]=n}}}}}return b}"function"!=typeof a&&(a=function(a){throw new TypeError("Unexpected character at index "+(this.index-1)+": "+a)});var c=[],d=[],e=0;this.state=0,this.index=0,this.input="",this.addRule=function(a,b,c){var e=a.global;if(!e){var f="g";a.multiline&&(f+="m"),a.ignoreCase&&(f+="i"),a=new RegExp(a.source,f)}return"[object Array]"!==Object.prototype.toString.call(c)&&(c=[0]),d.push({pattern:a,global:e,action:b,start:c}),this},this.setInput=function(a){return e=0,this.state=0,this.index=0,c.length=0,this.input=a,this},this.lex=function(){if(c.length)return c.shift();for(this.reject=!0;this.index<=this.input.length;){for(var d=b.call(this).splice(e),f=this.index;d.length&&this.reject;){var g=d.shift(),h=g.result,i=g.length;this.index+=i,this.reject=!1,e++;var j=g.action.apply(this,h);if(this.reject)this.index=h.index;else if("undefined"!=typeof j)switch(Object.prototype.toString.call(j)){case"[object Array]":c=j.slice(1),j=j[0];break;default:return i&&(e=0),j}}var k=this.input;if(f<k.length)if(this.reject){e=0;var l=a.call(this,k.charAt(this.index++));if("undefined"!=typeof l)return"[object Array]"===Object.prototype.toString.call(l)?(c=l.slice(1),l[0]):l}else this.index!==f&&(e=0),this.reject=!0;else{if(!d.length)break;this.reject=!0}}}}var g=function(a){var b=/[^\w\s]/g,c=a.replace(b," ");return c.split(/\s+/)},h=function(a){return a.split(/\s+/)};c.prototype.initializeCategory=function(a){return this.categories[a]||(this.docCount[a]=0,this.wordCount[a]=0,this.wordFrequencyCount[a]={},this.categories[a]=!0),this},c.prototype.learn=function(a,b){var c=this;c.initializeCategory(b),c.docCount[b]++,c.totalDocuments++;var d=c.tokenizer(a),e=c.frequencyTable(d);return Object.keys(e).forEach(function(a){c.vocabulary[a]||(c.vocabulary[a]=!0,c.vocabularySize++);var d=e[a];c.wordFrequencyCount[b][a]?c.wordFrequencyCount[b][a]+=d:c.wordFrequencyCount[b][a]=d,c.wordCount[b]+=d}),c},c.prototype.categorize=function(a){var b=this,c=-(1/0),d=null,e=b.tokenizer(a),f=b.frequencyTable(e);return Object.keys(b.categories).forEach(function(a){var e=b.docCount[a]/b.totalDocuments,g=Math.log(e);Object.keys(f).forEach(function(c){var d=f[c],e=b.tokenProbability(c,a);g+=d*Math.log(e)}),g>c&&(c=g,d=a)}),d},c.prototype.tokenProbability=function(a,b){var c=this.wordFrequencyCount[b][a]||0,d=this.wordCount[b];return(c+1)/(d+this.vocabularySize)},c.prototype.frequencyTable=function(a){var b={};return a.forEach(function(a){b[a]?b[a]++:b[a]=1}),b};var i={"的":1};d.prototype={isWord:function(){return this._isWord&&0===this._count},asWord:function(){this._isWord=!0},addCount:function(){this._count++}},e.prototype={toBytes:function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b.push(d):b=b.concat(this.toUTF8(d))}return b},toUTF8:function(a){var b,c,d;return b=224|a>>12&15,c=128|a>>6&63,d=128|63&a,[b,c,d]},toUTF16:function(a,b,c){var d,e,f;return d=a<<4|b>>2&15,e=(3&b)<<6|63&c,f=(255&d)<<8|e},add:function(a){for(var b=this.root,c=this.toBytes(a),e=c.length,f=0;e>f;f++){var g=c[f];g in b.childs||(b.childs[g]=new d(g)),b=b.childs[g]}b.asWord()},search:function(a){for(var b=this.root,c=a.length,d=[],e=[],f=0,g=0;c>g;g++){var h=a[g],j=b.childs;if(!(h in j))return d;if(128>h)e.push(String.fromCharCode(h));else if(f++,f%3===0){var k=a[g-2],l=a[g-1],m=h;e.push(String.fromCharCode(this.toUTF16(k,l,m)))}if(e.join("")in i)return d;var n=j[h];n.isWord()&&(n.addCount(),d.push(e.join(""))),b=n}return d},splitWords:function(a){for(var b=this.toBytes(a),c=0,d=b.length-1,e=[];c!=d;){for(var f,g,h=[],i=c;d>=i;i++)f=b[i],h.push(f),g=this.search(h),g!==!1&&g.length>0&&(e=e.concat(g));c++}return e},init:function(a){for(var b=0;b<a.length;b++)this.add(a[b])}};var j=["古代","现在","此时","此刻","等于","是","今天","点"],k=[],l=[{time:"子时",from:"23",to:"1"},{time:"丑时",from:"1",to:"3"},{time:"寅时",from:"3",to:"5"},{time:"卯时",from:"5",to:"7"},{time:"辰时",from:"7",to:"9"},{time:"巳时",from:"9",to:"11"},{time:"午时",from:"11",to:"13"},{time:"未时",from:"13",to:"15"},{time:"申时",from:"15",to:"17"},{time:"酉时",from:"17",to:"19"},{time:"戌时",from:"19",to:"21"},{time:"亥时",from:"21",to:"23"}],m=["现在","Today","此时","此刻","今天"],n=["是","等于"],o={};o.combinedObjString=function(a,b){return"object"!=typeof b[0]?b.forEach(function(b){a.push(b)}):b.forEach(function(b){a.push(b.time)}),a},o.objectToStringRegex=function(a){var b="";return a.forEach(function(a){b=b+a.time+"|"}),b.substring(0,b.length-1)},o.arrayToStringRegex=function(a){var b="";return a.forEach(function(a){b=b+a+"|"}),b.substring(0,b.length-1)},o.stringToRegex=function(a){return new RegExp(a)},o.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a},k=o.combinedObjString(j,l),k=o.combinedObjString(k,m),k=o.combinedObjString(k,n);var p=function(){};p.parser=function(a){return this.time=a,this},p.convert=function(){var a,b={},c=new p.trie,d=new p.lexer;c.init(k);var e=o.stringToRegex(o.objectToStringRegex(l));d.addRule(e,function(a){var b={};return l.forEach(function(c){c.time===a&&(b=c,delete b.time)}),{time:b}});var f=o.stringToRegex(o.arrayToStringRegex(m));d.addRule(f,function(){return{now:!0}});var g=o.stringToRegex(o.arrayToStringRegex(n));d.addRule(g,function(){return{condition:"equal"}}),d.addRule(/点/,function(){return{clock:"hour"}});var h=c.splitWords(this.time);return h.forEach(function(c){d.setInput(c),a=d.lex(),o.extend(b,a)}),b.time},p.version=p.VERSION="0.0.1",p.trie=e,p.lexer=f,p.bayes=c,a.Geng=p}(this);